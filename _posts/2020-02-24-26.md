---
layout: episode
title: "26: iOS é–‹ç™¼ç”Ÿå¹³å¤§å‘ä¹‹ DateFormatter"
description: weak self podcast
date: 2020-02-23 22:00:00 +0800
categories: 
---
<iframe src="https://www.listennotes.com/embedded/e/46e6dc70feeb4e8bb3520edc66c60d38/" width="100%" style="width: 1px; min-width: 100%;" frameborder="0" scrolling="no"></iframe>

ç‚ºäº†è®“ç¯€ç›®å…§å®¹å…¼å…·æŠ€è¡“èˆ‡é–’èŠï¼Œæˆ‘å€‘è¨è«–è‘— iOS é–‹ç™¼æ™‚é‡åˆ°çš„å‘ã€‚é€™é›†å°±ç”± 13 å…ˆè¬›èˆ‡ DateFormatter çš„ä¸è§£ä¹‹ç·£ã€‚

## ç¬¬ä¸€æ¬¡ï¼šNSDateFormatter init çš„å‘

ä»¥å‰[å®˜æ–¹æ–‡ä»¶](https://developer.apple.com/documentation/foundation/nsdateformatter)æœ‰å¯«èªª `[[NSDateFormatter alloc]init]` æ˜¯ CPU expansive taskï¼Œä¸éç¾åœ¨é€™å¥è©±æ‰¾ä¸åˆ°äº†ã€‚åªæœ‰åœ¨ [StackOverflow](https://stackoverflow.com/questions/8832768/why-is-allocating-or-initializing-nsdateformatter-considered-expensive) ä¸Šé‚„æœ‰è¨˜éŒ„ã€‚

> è«– iOS App Performance Optimization
> Q. å¦‚ä½•å¤§å¹…æå‡ compile time æ•ˆç‡ï¼Ÿ
> A. è²·æœ€æ–°çš„ Apple é›»è…¦
>
> Q. å¦‚ä½•å¤§å¹…æå‡ runtime æ•ˆç‡ï¼Ÿ
> A. ç­‰ä½¿ç”¨è€…è²·æœ€æ–°çš„ Apple è£ç½®
> 
> çµè«–ï¼š
> äººå€‘èªªã€Œèƒ½é èŠ±éŒ¢å¯ä»¥è§£æ±ºçš„éƒ½ä¸æ˜¯é›£äº‹ã€ï¼Œæ˜¯ä¸æ˜¯æ²’æœ‰å¾ˆé›£ï¼ŸğŸ¤ªğŸ¤ªğŸ¤ª
> [@ethanhuang13](https://twitter.com/ethanhuang13/status/1225941484546838528)

## ç¬¬äºŒæ¬¡ï¼šDateFormatter çš„ Calendar å‘

> If unspecified, the logical calendar for the current user is used. - [DateFormatter.calendar](https://developer.apple.com/documentation/foundation/dateformatter/1413675-calendar)

å¦‚æœæ²’æœ‰æŒ‡å®šçš„è©±, `DateFormatter` å°±æœƒä½¿ç”¨ `ç³»çµ±è¨­å®š > ä¸€èˆ¬ > èªè¨€èˆ‡åœ°å€ > æ›†æ³•` ä¸Šçš„è¨­å®šï¼Œé™¤äº†è¥¿æ›†ä»¥å¤–ï¼Œé‚„æœ‰æ—¥æœ¬æ›†ã€ä½›æ›†å¯ä»¥é¸ã€‚

Calendar é¸ Gregorian è·Ÿ ISO8061 æ™‚ï¼Œ[yearForWeekOfYear](https://developer.apple.com/documentation/foundation/nsdatecomponents/1413809-yearforweekofyear) ç®—æ³•ä¸ä¸€æ¨£ã€‚

## ç¬¬ä¸‰æ¬¡ï¼šDateFormatter çœŸçš„ç‚¸æ‰äº†

`String` è½‰ `Date` æ˜¯ `nil`ï¼Œå¥‡æ€ªå’§ï¼ï¼Ÿ

é¦–å…ˆæ’é™¤å¯èƒ½æ€§ï¼š

* App åˆªæ‰é‡è£é
* iOS å‡ç´šåˆ°æœ€æ–°ç‰ˆ
* ç³»çµ±çš„æ›†æ³•è¨­å®šæ˜¯è¥¿æ›†ï¼Œæˆ–æ˜¯ `DateFormatter` æœ‰æŒ‡å®š `calendar`
* ç³»çµ±æ™‚é–“æ²’æœ‰äº‚èª¿
* `DateFormatter` ä¸çŸ¥ä»€éº¼åŸå› ç‚¸æ‰äº†

æœ€å¾Œè™•ç†æ–¹æ³•ï¼šå»æ‰¾ä½¿ç”¨è€…å€Ÿè£ç½® debug

## å–¬å–¬ Bonusï¼šå¯« Android ä¹Ÿæ‡·ç–‘äººç”Ÿ

* å–¬å–¬ç¶“é©—åˆ†äº«
* æ‰¾ä½¿ç”¨è€… debug

## ISO8601DateFormatter

å¦‚æœè¦ä½¿ç”¨ ISO8601 Date çš„è©±ï¼ŒiOS 10+ æ¨è–¦ä½¿ç”¨ [ISO8601DateFormatter](https://developer.apple.com/documentation/foundation/iso8601dateformatter)ã€‚

## æ³¢è‚¥ Bonus: ä¹Ÿæ˜¯ DateFormatter

* DateFormatter çš„ threading issue
* How iOS alloc and free

## Thread-Safe çš„æ™‚å…‰ç¸½æ˜¯ç‰¹åˆ¥çŸ­æš«

## æ›´å¤š weak self

* è½çœ¾ä¿¡ç®± [weakself.dev@gmail.com](mailto:weakself.dev@gmail.com)
* å®˜ç¶² [https://weakself.dev](https://weakself.dev)
* ä¸»æŒäºº [ä¸€ä¸‰](https://twitter.com/ethanhuang13)ã€[æ³¢è‚¥](https://twitter.com/PofatTseng)ã€[å–¬å–¬](https://twitter.com/joe_trash_talk)
* Twitter [@weak_self](https://twitter.com/weak_self)
* [æå•ç®±](https://peing.net/zh-TW/weak_self)
* [è´ŠåŠ© weak self](https://weakself.dev/#è´ŠåŠ©)