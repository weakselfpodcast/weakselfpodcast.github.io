---
layout: episode
title: "10: 喬喬 escaping"
description: weak self podcast
date: 2019-09-29 22:30:00 +0800
categories: 
---
<iframe src="https://anchor.fm/weakself/embed/episodes/10--escaping-e5l7p6" height="102px" width="400px" frameborder="0" scrolling="no"></iframe>

本集竟然有人 escape！那我們就順勢來回應與 @escaping 有關的 [#weakself挑戰賽](https://twitter.com/hashtag/weakself挑戰賽)吧！為什麼 Swift closure 的 [weak self] 要加中括號呢？weak、unowned 你分得清楚差別嗎？一起來參與挑戰吧。

## weak self 挑戰賽

* 小綠的挑戰[推文](https://twitter.com/handkid/status/1174669625579032578?s=20)
* 何謂 escaping、nonescaping closure
* 何時用 weak、unowned，或是不用

## Closure 的行為

* 搭配服用的[程式範例](https://gist.github.com/pofat/0c5d0ab99c95bb7b9663b57b550feea4)
* closure 預設會 capture (strong reference) 外部變數
* capture list 會生成一份 copy

## Escaping 和 Nonescaping

* function return 後還會發生的叫做 escaping
* 有機會造成 retain cycle

## Weak 和 Unowned 的運作原理

* Swift 的 reference instance 是個 HeapObject
* [HeapObject](https://github.com/apple/swift/blob/4fd0671e542299d7805e41cf9426640ab3b399af/stdlib/public/SwiftShims/HeapObject.h#L45)
* weak reference 會為 instance 建立 side table 用來計算數目
* [Swift Ownership Manifesto](https://github.com/apple/swift/blob/master/docs/OwnershipManifesto.md)
* [Objective-C 的 ARC 功能如果不是因為創立全新語言 Swift 時追求 memory safety，恐怕從來不會出現。](https://twitter.com/ethanhuang13/status/1099200155318767616)有興趣的朋友可以去聽 [The Swift Community Podcast Ep.1](https://www.swiftcommunitypodcast.org/episodes/1)。

## 何時用 weak 或是 unowned？

* closure 生命週期與對象生命周期一致時，使用 unowned
* weak 有較多記憶體消耗
* 要了解程式碼裡大家的生命周期啊

## 挑戰賽小結

* closure 會捕捉外部使用的變數，有可能造成 retain cycle
* weak 和 unowned 有不同的機制與生命週期
* 沒有 retain cycle 不用 weak / unowned
* weak 有額外的記憶體與性能消耗（可忽略）

## 工程師的 escape

* [最後生還者 Part II](https://asia.playstation.com/cht-tw/games/the-last-of-us-part-ii-ps4/)

## 13 最近在玩 Apple Arcade
* 13 的 Apple [#ArcadeReview](https://twitter.com/search?q=%23ArcadeReview%20%40ethanhuang13) 連載中
* iPad mini 超適合玩 Apple Arcade 的，又輕又快又平💸

## 歡樂的時光總是過得特別快

## 更多 weak self

* 主講人 [一三](https://twitter.com/ethanhuang13)、[波肥](https://twitter.com/PofatTseng)、[喬喬](https://twitter.com/joe_trash_talk)
* 官網 [https://weakself.dev](https://weakself.dev)
* Twitter [@weak_self](https://twitter.com/weak_self)
* [提問箱](https://peing.net/zh-TW/weak_self)