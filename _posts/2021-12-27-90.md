---
layout: episode
title: "90: å‹•æ…‹å°‹æ‰¾æˆå“¡"
description: weak self podcast
date: 2021-12-27 06:00:00 +0800
categories:
---

<iframe src="https://www.listennotes.com/podcasts/weak-self/90-å‹•æ…‹å°‹æ‰¾æˆå“¡-z1sAMX9-Jaf/embed/" width="100%" style="width: 1px; min-width: 100%;" loading="lazy" frameborder="0" scrolling="no"></iframe>

ç°¡çŸ­ä»‹ç´¹ä¸€å€‹è¶…å¯¦ç”¨çš„ Swift å†·é–€æŠ€å·§ã€‚å¯« SwiftUI å¾ˆæœ‰æ©Ÿæœƒç”¨åˆ°ã€‚

## ğŸ‘‹é–‹å ´ & ç¯€ç›®å›é¡§

å†è£œå……ä¸€ä¸‹ weak self Discord çš„ç©æ³•ã€‚[è«‹æŒ‰æˆ‘åŠ å…¥](https://discord.gg/SfV5a2Rv)ï¼ˆæ¯é›†æ›´æ–°é€£çµï¼‰ã€‚

## â­ï¸@dynamicMemberLookup

- å¸¸ç”¨æƒ…å¢ƒï¼šmodel éœ€è¦è¢«æ‹“å±•ï¼Œä½†ä¸èƒ½æˆ–ä¸æƒ³ç”¨ç¹¼æ‰¿çš„æ–¹å¼

```swift
struct FooModel {
  var string: String
}

@dynamicMemberLookup
struct FooWrapper {
  var wrapped: FooModel

  subscript<Value>(dynamicMember keyPath: KeyPath<FooModel, Value>) -> Value {
    wrapped[keyPath: keyPath]
  }
}

// ä½¿ç”¨ï¼šå¯ç›´æ¥å–ç”¨ wrapped è£¡çš„ property
let string = FooWrapper().string
```

- æˆ–è€…åšæˆ generic çš„ç‰ˆæœ¬

```swift
@dynamicMemberLookup
struct AnyWrapper<T> {
  var wrapped: T

  subscript<Value>(dynamicMember keyPath: KeyPath<T, Value>) -> Value {
    wrapped[keyPath: keyPath]
  }
}
```

- è¦æ”¯æ´å¯«å…¥å‰‡éœ€è¦ç”¨åˆ°`WritableKeyPath`

```swift
  subscript<Value>(dynamicMember keyPath: WritableKeyPath<T, Value>) -> Value {
    get {
      wrapped[keyPath: keyPath]
    }
    set {
      wrapped[keyPath: keyPath] = newValue
    }
  }
```

- 13 æåˆ°çš„ generic id wrapperï¼Œçœ‹è«‹æ³å¯ç”¨åœ¨ SwiftUI çš„ ForEach ä½¿ç”¨

```swift
struct IdentifiableWrapper<T>: Identifiable {
  let id = UUID()
  var wrapped: T

  init(_ wrapped: T) {
    self.wrapped = wrapped
  }
}

struct Model {
  var title: String
}

// ä½¿ç”¨æ–¹å¼ï¼šå†é©ç•¶çš„æ™‚æ©Ÿç”¨ wrapper åŒ…èµ·ä¾†
// è«‹ä¸è¦åœ¨ SwiftUI è£¡é¢åš .mapï¼Œå› ç‚º id è¦ç›¡å¯èƒ½ä¿æŒä¸€è‡´
let models = [Model(title: "æ¨™é¡Œ")...].map(IdentifiableWrapper.init)

// å†é€è‡³ SwiftUI çš„ ForEach ä½¿ç”¨
ForEach(models) {
  Text($0.wrapped.title)
}
```

- Generic id wrapper çš„ `@dynamicMemberLookup` çš„ç‰ˆæœ¬

```swift
@dynamicMemberLookup
struct IdentifiableWrapper<T>: Identifiable {
  let id = UUID()
  var wrappedValue: T

  init(_ wrappedValue: T) {
    self.wrappedValue = wrappedValue
  }

  subscript<Value>(dynamicMember keyPath: KeyPath<T, Value>) -> Value {
    wrappedValue[keyPath: keyPath]
  }
}

// é€™æ®µåŒä¸Š
struct Model {
  var title: String
}

// é€™æ®µåŒä¸Š
let models = [Model(title: "æ¨™é¡Œ")...].map(IdentifiableWrapper.init)

// å†é€è‡³ SwiftUI çš„ ForEach ä½¿ç”¨ï¼Œä¸ç”¨å†å¯« .wrapped ä¾¿å¯ä½¿ç”¨
ForEach(models) {
  Text($0.title)
}
```

- åµŒå¥—çš„ `@dynamicMemberLookup` æ˜¯å¯è¡Œçš„
- property name ç›¸åŒçš„è©±ï¼Œæœƒå–ä¸Šå±¤çš„

## ğŸ’¸å‹¸æ•—è©±é¡Œ

- é å‘Šï¼šSwift Playgrounds 4 é‚„ä¾†ä¸åŠæ·±å…¥ç ”ç©¶ï¼Œæœ‰æ©Ÿæœƒå†èŠ
- 13ï¼šè…¦èˆªå“¡2
    - [ä¸­æ–‡åŒ–é€£ç½²](https://forum.gamer.com.tw/C.php?bsn=60646&snA=1987)
- Pofatï¼šåœ°ç„ä¹‹åˆƒ
- å…©æ¬¾éƒ½åœ¨ XGP è£¡ï¼Œå……åˆ†ç™¼æ®ä½æˆæœ¬è©¦éŒ¯çš„å„ªé»
- æ“æœ‰é¸æ“‡æ¬Š

## ğŸ‘‹æ”¶å°¾ & é å‘Š

- é å‘Šï¼šå–¬å–¬å›æ­¸

## æ›´å¤š weak self

- è½çœ¾ä¿¡ç®± [weakself.dev@gmail.com](mailto:weakself.dev@gmail.com)
- å®˜ç¶² [https://weakself.dev](https://weakself.dev/)
- ä¸»æŒäºº [ä¸€ä¸‰](https://twitter.com/ethanhuang13)ã€[æ³¢è‚¥](https://twitter.com/PofatTseng)
- Twitter [@weak_self](https://twitter.com/weak_self)
- [æå•ç®±](https://peing.net/zh-TW/weak_self)
- [è´ŠåŠ© weak self](https://weakself.dev/#donation)